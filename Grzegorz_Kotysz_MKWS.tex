\documentclass[12pt,english]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[a4paper]{geometry}
\geometry{verbose,tmargin=2cm,bmargin=2cm,lmargin=2cm,rmargin=2cm}
\usepackage{array}
\usepackage{float}
\usepackage{multirow}
\usepackage{amstext}
\usepackage{graphicx}
\usepackage{listings} % enables source code to be pasted

\makeatletter
\makeatother

\usepackage{babel}
\begin{document}

\title{ISAT-CK7 in OpenFOAM}


\author{Grzegorz Kotysz}


\date{UPDATE}

\maketitle
\newpage{}

\tableofcontents{}

\newpage{}

\section{Introduction}

The goal of this paper is to reproduce tutorial case\footnote{Daniel Moëll, Siemens Industrial Turbomachinery AB/Fluid Mechanics Lund University, 2015-12-08, url: http://www.tfd.chalmers.se/\~{}hani/kurser/OS\_CFD\_2015/DanielMoell/Presentation\_ISAT-CK7.pdf, Accessed: 06.04.2018}, which was prepared by Daniel Moëll for the course "CFD with OpenSource Software". 

\section{Preparing tutorial case}

The first step of this paper is to create an adjusted tutorial case. The first step is to copy the already present tutorial case from the OpenFOAM directory. As the OpenFOAM v1712 is used in this paper, there are some differences compared to the aforementioned work. In order to copy the tutorial case, following command has to be executed while being in OpenFOAM bash:
\begin{lstlisting}
cp -r 
$FOAM_TUTORIALS/combustion/reactingFoam/laminar/counterFlowFlame2D
$WM_PROJECT_USER_DIR/run
\end{lstlisting}

The directiory where counterFlowFlame2D tutorial was changed in the newer version of OpenFOAM, hence the change from \textit{ras} to \textit{laminar}. Then, the chemkin directory must be created in counterFlowFlame2D
\begin{lstlisting}
cd $WM_PROJECT_USER_DIR/run/counterFlowFlame2D
mkdir chemkin
\end{lstlisting}

Now the appropriate case files have to be edited in order to use chemkin files. Following changes to the constant/thermophysicalProperties file need to be made:
\begin{lstlisting}
chemistryReader foamChemistryReader;
foamChemistryFile "$FOAM_CASE/constant/reactions";
foamChemistryThermoFile "$FOAM_CASE/constant/thermo.compressible";
\end{lstlisting}
to:
\begin{lstlisting}
chemistryReader chemkinReader;
CHEMKINFile "$FOAM_CASE/chemkin/drm19.dat";
CHEMKINThermoFile "$FOAM_CASE/chemkin/thermo30.dat";
\end{lstlisting}
It seems now transport properties are not hard-coded anymore in chemkinReader, hence, transport file must be prepared.\footnote{https://bugs.openfoam.org/view.php?id=1888} However, it seem now it is impossible to use chemkinReader.\footnote{https://bugs.openfoam.org/view.php?id=2582} Hence, chemkinToFoam will be used to translate chemkin files to foam files by running command, where foamChemistry and foamThermo are names of the reactions and thermodynamics properties files.
\begin{lstlisting}
cd $caseDir/chemkin
chemkinToFoam drm19.dat thermo30.dat transport.dat foamChemistry foamThermo
\end{lstlisting}
Now, the constant/thermophysicalProperties must be changed to read files from chemkin directory.
\begin{lstlisting}
foamChemistryFile "$FOAM_CASE/chemkin/foamChemistry";
foamChemistryThermoFile "$FOAM_CASE/chemkin/foamThermo";
\end{lstlisting}
Unfortunately, chemkinToFoam requires files in CHEMKIN 3 format\footnote{https://www.openfoam.com/documentation/user-guide/standard-utilities.php#dx33-136284} and these files are now inaccessible, so the reaction and thermodynamics data will be taken from tutorials in OpenFOAM installation.
The constant/thermophysicalProperties must be changed to read files from chemkin directory.
\begin{lstlisting}
foamChemistryFile "$FOAM_CASE/constant/reactionsGRI";
foamChemistryThermoFile "$FOAM_CASE/constant/thermo.compressibleGasGRI";
\end{lstlisting}

As the aforementioned tutorial aims to simulate premixed flame, some changes to boundary conditions wll be made. Afterwards, the case will simulate counterflow of two premixed fuel-air mixtures with the temperature of 305$K$ with the velocity equal to 0.8$m/s$. The ignition will be implemented as the high temperature zone in the middle of the domain by the use of setFields command, so the appropriate setFieldsDict file must be created.
In the end one can run the case via following set of commands:
\begin{lstlisting}
cd $caseDir/
blockMesh
setFields
reactingFoam
\end{lstlisting}

\section{Compiling ISAT-CK7}
In order to use ISAT-CK7 code, both Cantera and the code itself must be compiled. There are following prerequisites:
\begin{itemize}
\item g++
\item python
\item scons
\item libboost-all-dev
\item libsundials-serial-dev
\item cython
\item python-dev
\item python-numpy
\item python-numpy-dev
\end{itemize}
It is necessary to adjust Cantera build options for both codes to work properly. First of all, Cantera must be downloaded\footnote{url: https://sourceforge.net/projects/cantera/}. In this work Cantera 2.3.0 is used. As the aforementioned tutorial was written for Cantera 2.2.0, some changes had to be introduced. Namely, the -fPIC (Position Independent Code) flags must be added to certain functions.(ARE THEY REALLY FUNCTIONS? INQUIRE) Tutorial author presents line numbers, however, in this paper function names are also included, as the line numbers change between Cantera versions.
\begin{lstlisting}
L241 defaults.ccFlags = ' ' -> defaults.ccFlags = '-fPIC'
L409-411 ('FORTRANFLAGS', ..., '-03'), -> ('FORTRANFLAGS', ..., '-fPIC -03'),
\end{lstlisting}
In the original tutorial the 'F77FLAG' must also be changed, but it is not present in Cantera 2.3.0. The next step is to compile Cantera.
\begin{lstlisting}
scons build
scons install
\end{lstlisting}
Unfortunately, the following error was encountered:
\begin{lstlisting}
Checking for C++ header file fmt/ostream.h... no
INFO: Using private installation of fmt library.
ERROR: fmt is missing. Install source in ext/fmt.
\end{lstlisting}
Now, the ISAT-CK7 cantera fortran code must be downloaded.
	


\end{document}
